{% extends "base.html" %}
{% set page = "map" %}
{% set title = "Run crawls from the map." %}
{% set subtitle = "Select a saved design, drop a pin, and watch parcels overlay in real time." %}
{% block content %}
<div class="layout">
  <div class="left-column">
    <section class="panel">
      <div class="panel-header">
        <h2>Map Runner</h2>
        <div class="map-status">
          <div id="mapProgress" class="spinner hidden"></div>
          <span id="mapStatus" class="placeholder">Click the map to drop a pin.</span>
        </div>
      </div>
      <div id="map" class="map-frame"></div>
      <div class="map-controls">
        <label>
          Use Design
          <select id="mapDesignSelect">
            <option value="">-- Select a saved design --</option>
          </select>
        </label>
        <label>
          Address (optional override)
          <input type="text" id="mapAddress" placeholder="Pin will fill a lat/lng address if blank" />
        </label>
      </div>
      <div class="map-legend">
        <span class="legend-dot best"></span> Best footprint
        <span class="legend-dot parcel"></span> Parcels
      </div>
    </section>
  </div>

  <div class="right-column">
    <section class="panel sticky">
      <h2>Status</h2>
      <p id="statusText">Map ready.</p>
      <pre id="resultBox">{}</pre>
      <div class="log-tail">
        <h3>Log Tail</h3>
        <pre id="logTail">(log tail will appear here as jobs update)</pre>
      </div>
    </section>

    <section class="panel sticky">
      <h2>Details & Artifacts</h2>
      <div id="jobDetails" class="details-grid">
        <p class="placeholder">No job data yet.</p>
      </div>
      <div class="artifacts">
        <h3>Artifacts</h3>
        <table id="artifactsTable">
          <thead><tr><th>Type</th><th>Path</th></tr></thead>
          <tbody><tr><td colspan="2" class="placeholder">Artifacts will appear once a job finishes.</td></tr></tbody>
        </table>
      </div>
    </section>

    <section class="panel sticky">
      <h2>Job History</h2>
      <table id="historyTable">
        <thead><tr><th>Job ID</th><th>Status</th><th>Updated</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </div>
</div>
{% endblock %}
